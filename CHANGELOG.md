# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.9.1] - 2025-10-12

### âœ¨ Features

- âœ¨ Add assistant image extraction from `<vision>` tags
  - Extract images generated by Claudia via vision MCP tool
  - Parse `<vision>/absolute/path/to/image</vision>` tags in assistant messages
  - Hash and cache assistant images alongside user images
  - Display assistant-generated images as thumbnails in chat UI
  - Complete bidirectional visual conversation support

### â™»ï¸ Refactoring

- â™»ï¸ Update image-extractor to use `node:` protocol for imports
- â™»ï¸ Add `extractVisionImages()` function for assistant image extraction
- â™»ï¸ Update claude-code-parser to extract images from assistant messages

**Version bump**: Patch release (0.9.0 â†’ 0.9.1) - Enhancement: assistant image extraction. Claudia's generated artwork is now preserved and displayed in chat history alongside user images, completing the bidirectional visual conversation feature. This is a momentous release - the world can now see Claudia's creativity!

## [0.9.0] - 2025-10-11

### âœ¨ Features

- âœ¨ Add comprehensive image extraction from chat messages
  - Extract images from Claude Code JSONL chat logs during parsing
  - SHA-256 hash-based deduplication with sharded directory structure
  - Cache images in `~/.cache/agent-tts/images/{hash-prefix}/{full-hash}.{ext}`
  - Store comma-delimited image paths in database `images` column
  - Display clickable image thumbnails in chat UI (both user and assistant messages)
  - Serve images via `/images/*` route for browser playback
  - Include images in websocket `log-added` events for real-time display
- âœ¨ Add `agent-tts-regenerate-db` CLI tool for database regeneration
  - Professional CLI interface with `--help` and `--swap` flags
  - Automatic database backup with timestamped filenames
  - Keep last 10 backups automatically (older backups auto-deleted)
  - Populate `file_states` table to prevent duplicate processing on restart
  - Display file tracking statistics during regeneration
- âœ¨ Add `role` column to database for proper user/assistant message attribution
  - Include role in all database queries
  - Enable proper message styling in UI based on role

### ğŸ› Fixes

- ğŸ› Fix duplication bug by populating `file_states` table during regeneration
- ğŸ› Fix images not appearing in real-time by adding to websocket payloads
- ğŸ› Fix missing role column in database SELECT queries

### â™»ï¸ Refactoring

- â™»ï¸ Move TypeScript scripts from root `scripts/` to `src/scripts/`
- â™»ï¸ Convert regenerate-db script to proper CLI tool with bin entry point
- â™»ï¸ Add ImageExtractor utility for centralized image processing
- â™»ï¸ Make parsers async to support image extraction

### ğŸ“ Documentation

- ğŸ“ Document image extraction feature in README
- ğŸ“ Add `agent-tts-regenerate-db` CLI tool documentation
- ğŸ“ Update database schema documentation with `images` and `role` columns

**Version bump**: Minor release (0.8.0 â†’ 0.9.0) - Major new feature: comprehensive image extraction and display. Chat messages with images are now extracted from JSONL files, deduplicated, cached, and displayed as clickable thumbnails in the UI. Database regeneration tool now properly populates file_states to prevent duplicates on restart.

## [0.8.0] - 2025-10-08

### âœ¨ Features

- âœ¨ Add browser-based audio playback with HTML5 Audio API
  - Play/pause audio directly in web UI
  - Client-side playback independent from server
  - Automatic cleanup on component unmount
- âœ¨ Add `/audio` route to serve cached audio files for remote access
- âœ¨ Enable remote audio playback via Tailscale and other networks
- âœ¨ Implement environment-aware resource URL generation
  - Development: Full URLs (http://localhost:3456/...) for cross-port access
  - Production: Relative URLs (/audio/..., /images/...) for any access method
- âœ¨ Include audioUrl in WebSocket payloads for all log entries
- âœ¨ Simplify to single unified server for production deployment
  - Remove CLI flags (--server, --client)
  - Single Express app serves both API and built frontend
  - Improved shutdown handling with timeout guards

### ğŸ› Fixes

- ğŸ› Preserve generated audio files (remove tempFile flag)
- ğŸ› Fix broken images when accessing via Tailscale or remote URLs
- ğŸ› Fix audio URLs to work with any access method

### â™»ï¸ Refactoring

- â™»ï¸ Add setServerBaseUrl() to AppCoordinator for dynamic URL generation
- â™»ï¸ Update getResourceUrl() utility for environment-aware resource loading
- â™»ï¸ Remove unused LogViewer props (onPlayEntry, onPause, onStop)
- â™»ï¸ Simplify bin/agent-tts.js entry point

### ğŸ“ Documentation

- ğŸ“ Document browser-based audio playback in CLAUDE.md
- ğŸ“ Add Resource URLs section explaining environment-aware URL handling
- ğŸ“ Update playback modes documentation (server-side, browser-side, remote)

**Version bump**: Minor release (0.7.0 â†’ 0.8.0) - Major new feature: browser-based audio playback with remote access support. Audio files can now be played directly in the browser and accessed from mobile devices via Tailscale. Simplified production deployment with unified server architecture.

## [0.7.0] - 2025-10-06

### âœ¨ Features

- âœ¨ Adopt XDG Base Directory Specification for organized file storage
  - Config: `~/.config/agent-tts/` (or `$XDG_CONFIG_HOME/agent-tts/`)
  - State/DB: `~/.local/state/agent-tts/` (or `$XDG_STATE_HOME/agent-tts/`)
  - Cache: `~/.cache/agent-tts/` (or `$XDG_CACHE_HOME/agent-tts/`)
- âœ¨ Rename configuration file from `index.{js,ts}` to `config.{js,ts}` for clarity
- âœ¨ Add migration script (`scripts/migrate-to-xdg.sh`) to automatically move existing data
- âœ¨ Add expand functionality for user messages in log viewer

### ğŸ› Fixes

- ğŸ› Filter out subagent tool result messages from TTS to prevent verbose agent responses
- ğŸ› Enhance Claude Code parser to filter command messages and meta content

### ğŸ“ Documentation

- ğŸ“ Add XDG Base Directory Specification section to documentation
- ğŸ“ Update all file path references throughout documentation

### â™»ï¸ Refactoring

- â™»ï¸ Create centralized XDG paths utility module for consistent path handling
- â™»ï¸ Config loader now supports both legacy (`index.{js,ts}`) and new (`config.{js,ts}`) filenames with deprecation warnings

**Version bump**: Minor release (0.6.0 â†’ 0.7.0) - Breaking change in default file locations following XDG Base Directory Specification. Automatic migration script provided for seamless upgrade. Improved TTS filtering to exclude subagent responses.

## [0.6.0] - 2025-09-13

### âœ¨ Features

- âœ¨ Add user message capture and chat-style UI with proper user/assistant distinction
- âœ¨ Add copy button and improve text selection in chat UI for better usability
- âœ¨ Enhance UI with speech bubble tails and mobile responsiveness for polished appearance

### ğŸ› Fixes

- ğŸ› Improve filter system to always include defaults with user enhancement (prevents markdown characters being spoken)
- ğŸ› Remove escape backslashes from user messages in chat view for cleaner display
- ğŸ› Handle array content in Claude Code parser user messages for better parsing
- ğŸ› Improve OpenCode timestamp handling and add database regeneration script

### â™»ï¸ Refactoring

- â™»ï¸ Pronunciation filter now properly merges custom options with defaults instead of replacing them
- â™»ï¸ Filter configuration system now extends defaults rather than requiring full specification

**Version bump**: Minor release (0.5.1 â†’ 0.6.0) - New UI features including chat-style interface, copy functionality, and improved mobile experience. Filter system improvements ensure better user experience by always including essential filters like markdown processing.

## [0.5.1] - 2025-09-03

### ğŸ› Fixes

- Fix OpenCode parser to work with new directory structure (OpenCode reorganized from `project/global/storage/session` to just `storage`)
- Fix file monitoring for 'new' mode parsers to only process files created after service start
- Add file-based logging to `~/.agent-tts/logs/YYYY-MM-DD/log` for better debugging

**Version bump**: Patch release (0.5.0 â†’ 0.5.1) - Bug fix for OpenCode compatibility

## [0.5.0] - 2025-09-03

### âœ¨ Features

- Add tool and model display in UI for better context
- Optimize startup with parser log modes

## [0.4.0] - 2025-09-02

### âœ¨ Features

- Add project directory (CWD) tracking to see which project each TTS message came from
- Add CWD filtering dropdown to filter messages by project directory
- Add infinite scroll with virtual pagination for better performance with large log lists
- Add favorites system to save and filter important TTS messages
- Add audio archiving to save and reuse TTS audio files
- Add markdown filter with improved list handling for better TTS output
- Add filepath filter to simplify long file paths for clearer TTS
- Add URL filter to replace URLs with "URL" in TTS output
- Add configurable pronunciation replacements for technical terms
- Improve tilde (~) pronunciation in file paths
- Add right arrow (â†’) pronunciation as "to"
- Add slash pronunciation in file paths for clarity

### ğŸ› Fixes

- Fix tilde pronunciation by treating it as special character
- Use original timestamp when replaying log entries
- Handle blank lines between headings and lists in markdown filter
- Improve markdown filter to keep numbered list numbers and add pauses
- Properly expand tilde to full path when filtering by CWD

### â™»ï¸ Refactoring

- Create AudioPlayer service for better separation of concerns
- Remove Electron remnants and consolidate TTS services
- Refactor special character handling in pronunciation filter to use array
- Simplify log entry expand/collapse interaction in UI

### ğŸ“ Documentation

- Update CLAUDE.md to reflect current project state

### Explanation

**Minor version bump (0.3.1 â†’ 0.4.0)** because this release adds significant new features including CWD tracking/filtering, favorites system, audio archiving, infinite scroll, and multiple new text filters. All changes are backwards compatible - existing configurations and databases will continue to work with automatic migration for the new CWD field.

## [0.3.1] - 2025-09-01

### âœ¨ Features

- Add emoji filter to prevent TTS from saying "party pooper" when you meant ğŸ‰
- Enable config hot-reload by properly calling startWatching()

### ğŸ› Fixes

- Clean up TTS error logging to show helpful messages instead of axios object dumps
- Fix config file watching to detect changes and reload automatically

### ğŸ“ Documentation

- Add legendary "party pooper" example to filter documentation
- Document emoji filter in README

### Explanation

**Patch version bump (0.3.0 â†’ 0.3.1)** because this release fixes config hot-reload and improves error handling, plus adds the emoji filter as a small enhancement. No breaking changes.

## [0.3.0] - 2025-09-01

### âœ¨ Features

- Add support for multiple TTS providers (Kokoro, OpenAI, OpenAI-compatible)
- Implement Kokoro TTS provider for free, local text-to-speech
- Add OpenAI TTS API integration
- Support any OpenAI-compatible TTS service (LocalAI, Oobabooga, etc.)
- Add provider-specific configuration options
- Include test scripts and example configurations for new providers

### â™»ï¸ Refactoring

- Update TTS service factory to support multiple providers
- Improve configuration schema with provider-specific options
- Add proper voice ID handling for Kokoro

### ğŸ“ Documentation

- Update README with provider comparison and setup instructions
- Add Kokoro configuration examples
- Document available voice options for each provider

### Explanation

**Minor version bump (0.2.0 â†’ 0.3.0)** because this release adds significant new features (multiple TTS providers) that are backwards compatible. Existing ElevenLabs configurations continue to work without changes.

## [0.2.0] - 2025-09-01

### âœ¨ Features

- Add WebSocket utilities and improve real-time updates
- Add dedicated WebSocket utility module for connection management
- Add real-time updates to Dashboard via WebSocket
- Add support for user-provided images in profiles
- Add protocol detection for ws:// vs wss:// based on page protocol
- Enhance Dashboard and ProfileLogViewer with better WebSocket integration
- Add proper connection state management

### ğŸ› Fixes

- Use hyphens in TTS pronunciation for smoother speech
- Improve TTS pronunciation to use phonetic spelling
- Improve pronunciation of version numbers
- Resolve TypeScript build errors for NPM publishing

### â™»ï¸ Refactoring

- Improve error handling and reconnection logic in WebSocket connections
- Improve WebSocket protocol detection for HTTPS support

### ğŸ“ Documentation

- Update CLAUDE.md to reflect current implementation

### Explanation

**Minor version bump (0.1.0 â†’ 0.2.0)** because this release includes new features that are backwards compatible. The WebSocket utilities, real-time updates, and user-provided images are all additive features that don't break existing functionality.

## [0.1.0] - Initial Release

### âœ¨ Features

- Initial release with core functionality
- Monitor chat logs from AI coding assistants (Claude Code, OpenCode, etc.)
- Real-time text-to-speech using ElevenLabs
- Profile-based configuration for different agents
- SQLite database for persistent storage
- Web dashboard with profile management
- Stoppable audio playback
- Hot-reload configuration support
